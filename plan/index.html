<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Structure TDA</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#111319;
      --muted:#9aa3b2;
      --text:#eef1f7;
      --border:rgba(255,255,255,.10);
      --accent:#7dd3fc;
      --ok:#86efac;
      --warn:#fca5a5;
      --chip:#1b1f2a;
      --shadow: 0 10px 28px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 15% -10%, rgba(125,211,252,.18), transparent 60%),
                  radial-gradient(900px 600px at 110% 10%, rgba(134,239,172,.12), transparent 60%),
                  var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      line-height:1.3;
    }
    a{ color: inherit; }
    .wrap{ max-width:1100px; margin:0 auto; padding:16px; padding-bottom:48px; }
    .header{
      display:flex; gap:12px; align-items:flex-end; justify-content:space-between; flex-wrap:wrap;
      margin: 10px 0 16px;
    }
    .title{
      display:flex; gap:12px; align-items:center; min-width:260px;
    }
    .logo{
      width:42px; height:42px; border-radius:16px;
      border:1px solid var(--border);
      display:grid; place-items:center;
      background: rgba(255,255,255,.03);
    }
    h1{ margin:0; font-size:20px; font-weight:700; }
    .sub{ margin-top:4px; color:var(--muted); font-size:13px; display:flex; gap:10px; flex-wrap:wrap; }
    .actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .btn{
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-weight:600;
      font-size:13px;
      cursor:pointer;
      box-shadow:none;
      transition:.15s transform ease, .15s background ease;
      user-select:none;
    }
    .btn:active{ transform: scale(.98); }
    .btn.primary{ background: rgba(125,211,252,.14); border-color: rgba(125,211,252,.35); }
    .btn.danger{ background: rgba(252,165,165,.12); border-color: rgba(252,165,165,.35); }
    .btn.ghost{ background: transparent; }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card + .card{ margin-top:12px; }
    .card-h{
      padding:14px 14px 10px;
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .card-h h2{ margin:0; font-size:15px; }
    .card-h .muted{ color:var(--muted); font-size:13px; margin-top:6px; }
    .card-b{ padding: 0 14px 14px; }

    .grid{ display:grid; gap:12px; }
    @media (min-width: 980px){
      .grid.cols3{ grid-template-columns: 1fr 1fr 1fr; }
      .grid.cols2{ grid-template-columns: 1fr 1fr; }
    }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .field{
      width:100%;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .input, .select, .textarea{
      width:100%;
      border:1px solid var(--border);
      background: rgba(0,0,0,.25);
      color:var(--text);
      border-radius:14px;
      padding:12px 12px;
      font-size:14px;
      outline:none;
    }
    .textarea{ min-height:120px; resize:vertical; }
    .inline{ width:auto; }
    .w-140{ width:140px; }
    .w-120{ width:120px; }
    .w-100{ width:100px; }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-size:12px; color: var(--muted);
    }
    .pill strong{ color: var(--text); font-weight:700; }

    .tabs{
      display:flex; gap:6px; flex-wrap:wrap;
      background: rgba(255,255,255,.03);
      border:1px solid var(--border);
      padding:6px;
      border-radius: 18px;
      margin: 12px 0;
    }
    .tab{
      flex:1;
      min-width:120px;
      text-align:center;
      padding:10px 10px;
      border-radius: 14px;
      cursor:pointer;
      border:1px solid transparent;
      color: var(--muted);
      font-weight:700;
      font-size:13px;
      user-select:none;
    }
    .tab.active{
      background: rgba(255,255,255,.06);
      border-color: var(--border);
      color: var(--text);
    }

    .list{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .item{
      border:1px solid var(--border);
      background: rgba(0,0,0,.20);
      border-radius: 16px;
      padding:12px;
    }
    .item-top{
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
    }
    .item-left{
      display:flex; gap:10px; align-items:flex-start; min-width:0; flex:1;
    }
    .chk{
      width:20px; height:20px; border-radius:999px;
      border:1px solid var(--border);
      display:grid; place-items:center;
      margin-top:1px;
      cursor:pointer;
      user-select:none;
    }
    .chk.done{
      border-color: rgba(134,239,172,.55);
      background: rgba(134,239,172,.10);
      color: var(--ok);
    }
    .item-text{
      min-width:0;
    }
    .item-text .t{
      font-size:14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .item-text .t.done{
      text-decoration: line-through;
      color: var(--muted);
    }
    .meta{ margin-top:6px; display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      display:inline-flex; align-items:center; gap:6px;
      padding:5px 8px;
      border-radius:999px;
      background: var(--chip);
      border: 1px solid var(--border);
      font-size:12px; color: var(--muted);
    }
    .chip.badge{ color: var(--text); border-color: rgba(125,211,252,.35); background: rgba(125,211,252,.10); }
    .chip.warn{ border-color: rgba(252,165,165,.35); background: rgba(252,165,165,.10); }

    .item-actions{ display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end; }
    .mini{
      padding:8px 10px;
      border-radius: 12px;
      font-size:12px;
    }

    .notes{
      margin-top:10px;
      padding:10px;
      border-radius: 14px;
      background: rgba(255,255,255,.03);
      border:1px solid var(--border);
      color: var(--text);
      font-size:13px;
      white-space: pre-wrap;
    }

    .hint{
      border:1px dashed var(--border);
      border-radius: 16px;
      padding:12px;
      color: var(--muted);
      font-size:13px;
      background: rgba(255,255,255,.02);
    }
    .split{
      height:1px;
      background: var(--border);
      margin: 12px 0;
    }

    .timer{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .bigtime{
      font-size:54px;
      font-weight:800;
      letter-spacing:-1px;
      line-height:1;
      margin-top:6px;
    }
    .small{
      font-size:13px; color: var(--muted);
    }
    .two{
      display:grid; gap:10px;
    }
    .footer{
      text-align:center;
      color: var(--muted);
      font-size:12px;
      margin-top:18px;
    }
    .hidden{ display:none !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">
        <div class="logo">üß†</div>
        <div>
          <h1>Dashboard Structure</h1>
          <div class="sub">
            <span id="today"></span>
            <span>‚Ä¢</span>
            <span>3 listes ‚Ä¢ Focus ‚Ä¢ Rituels</span>
          </div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" id="exportBtn">Export JSON</button>
        <label class="btn" style="display:inline-flex; gap:8px; align-items:center;">
          Import
          <input id="importInput" type="file" accept="application/json" style="display:none;">
        </label>
        <button class="btn danger" id="resetBtn">R√©initialiser</button>
      </div>
    </div>

    <!-- Quick capture -->
    <div class="card">
      <div class="card-h">
        <div>
          <h2>Capture rapide (Inbox)</h2>
          <div class="muted">Z√©ro r√©flexion : si ce n‚Äôest pas dans l‚Äôinbox, √ßa n‚Äôexiste pas.</div>
        </div>
        <span class="pill"><strong>Astuce</strong> Note ‚Äúmoche‚Äù d‚Äôabord, tu trieras apr√®s.</span>
      </div>
      <div class="card-b">
        <div class="field">
          <input class="input" id="quickText" placeholder="Note brute (sans r√©fl√©chir)" />
          <select class="select inline w-140" id="quickTag">
            <option value="pro">Pro</option>
            <option value="perso">Perso</option>
            <option value="mix">Mix</option>
          </select>
          <button class="btn primary inline" id="quickAdd">Ajouter</button>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs" role="tablist">
      <div class="tab active" data-tab="lists">Listes</div>
      <div class="tab" data-tab="focus">Focus</div>
      <div class="tab" data-tab="rituals">Rituels</div>
      <div class="tab" data-tab="plan">Plan 7j</div>
    </div>

    <!-- LISTS -->
    <section id="tab-lists">
      <div id="activeFullBanner" class="hint hidden" style="margin-bottom:12px;">
        <strong style="color:var(--text);">Active est pleine.</strong>
        <div style="margin-top:6px;">Limite: <span id="activeLimitText"></span>. Renvoie un item en Inbox/Parking pour ajouter.</div>
      </div>

      <div class="grid cols3">
        <!-- Inbox -->
        <div class="card">
          <div class="card-h">
            <div>
              <h2>Inbox <span class="pill"><strong id="countInbox">0</strong></span></h2>
              <div class="muted">Capture brute, z√©ro r√©flexion</div>
            </div>
          </div>
          <div class="card-b">
            <div class="field" style="margin-bottom:10px;">
              <input class="input" id="addInboxText" placeholder="Ajouter (petit pas, clair)" />
              <select class="select inline w-140" id="addInboxTag">
                <option value="pro">Pro</option>
                <option value="perso">Perso</option>
                <option value="mix">Mix</option>
              </select>
              <button class="btn inline" id="addInboxBtn">+ Ajouter</button>
            </div>
            <div class="list" id="listInbox"></div>
            <div class="hint" id="emptyInbox">Rien ici. Astuce : capture tout dans Inbox, puis trie en 30 secondes.</div>
          </div>
        </div>

        <!-- Active -->
        <div class="card">
          <div class="card-h">
            <div>
              <h2>Active <span class="pill"><strong id="countActive">0</strong></span></h2>
              <div class="muted">Ta r√©alit√© du moment (courte)</div>
            </div>
            <span class="pill"><strong id="activeCountPill">0</strong>/<span id="activeLimitPill">5</span></span>
          </div>
          <div class="card-b">
            <div class="field" style="margin-bottom:10px;">
              <input class="input" id="addActiveText" placeholder="Ajouter (si Active n‚Äôest pas pleine)" />
              <select class="select inline w-140" id="addActiveTag">
                <option value="pro">Pro</option>
                <option value="perso">Perso</option>
                <option value="mix">Mix</option>
              </select>
              <button class="btn inline" id="addActiveBtn">+ Ajouter</button>
            </div>
            <div class="list" id="listActive"></div>
            <div class="hint" id="emptyActive">Active doit rester courte (‚â§ 5). Si tu bloques, √©cris juste ‚Äúprochain pas‚Äù.</div>
          </div>
        </div>

        <!-- Parking -->
        <div class="card">
          <div class="card-h">
            <div>
              <h2>Parking <span class="pill"><strong id="countParking">0</strong></span></h2>
              <div class="muted">Important, mais pas maintenant</div>
            </div>
          </div>
          <div class="card-b">
            <div class="field" style="margin-bottom:10px;">
              <input class="input" id="addParkingText" placeholder="Ajouter (√† garder sans se disperser)" />
              <select class="select inline w-140" id="addParkingTag">
                <option value="pro">Pro</option>
                <option value="perso">Perso</option>
                <option value="mix">Mix</option>
              </select>
              <button class="btn inline" id="addParkingBtn">+ Ajouter</button>
            </div>
            <div class="list" id="listParking"></div>
            <div class="hint" id="emptyParking">Mets ici les id√©es, projets, ‚Äú√† r√©fl√©chir‚Äù (sans te parasiter).</div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <div class="card-h">
          <div>
            <h2>Rappels</h2>
            <div class="muted">Priorise par ‚Äú√ßa lib√®re ? √ßa d√©bloque ? plus petit pas ?‚Äù</div>
          </div>
          <span class="pill"><strong>R√®gle</strong> 60% fait &gt; 100% jamais fini</span>
        </div>
        <div class="card-b">
          <ul style="margin:0; padding-left:18px; color:var(--muted); font-size:13px;">
            <li>Si une id√©e arrive : note ‚Üí Inbox ‚Üí reviens au focus.</li>
            <li>D√©coupe jusqu‚Äô√† ce que ce soit ‚Äúmoins peur que s√©duisant‚Äù.</li>
            <li>Alarme/Timer = d√©clencheur externe (ne compte pas sur ‚Äúj‚Äôy penserai‚Äù).</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- FOCUS -->
    <section id="tab-focus" class="hidden">
      <div class="card">
        <div class="card-h">
          <div>
            <h2>Timer Focus</h2>
            <div class="muted">Point d‚Äôentr√©e clair : 15‚Äì25 min, puis pause.</div>
          </div>
          <div class="row">
            <span class="pill">Phase: <strong id="phaseLabel">Focus</strong></span>
            <span class="pill">Blocs: <strong id="blocksDone">0</strong></span>
          </div>
        </div>
        <div class="card-b">
          <div class="timer">
            <div>
              <div class="small">Temps restant</div>
              <div class="bigtime" id="timeLeft">25:00</div>
            </div>
            <div class="row">
              <button class="btn primary" id="startPauseBtn">D√©marrer</button>
              <button class="btn" id="resetTimerBtn">Reset</button>
              <button class="btn" id="setFocusBtn">Focus</button>
              <button class="btn" id="setBreakBtn">Pause</button>
              <button class="btn" id="setLongBreakBtn">Pause longue</button>
            </div>
          </div>

          <div class="split"></div>

          <div class="grid cols2">
            <div class="card" style="background:rgba(0,0,0,.12); box-shadow:none;">
              <div class="card-h">
                <div><h2 style="font-size:14px;">R√©glages Timer</h2></div>
              </div>
              <div class="card-b">
                <div class="grid" style="grid-template-columns:1fr 1fr; gap:10px;">
                  <div>
                    <div class="small">Focus (min)</div>
                    <input class="input" id="focusMin" type="number" min="5" max="90" />
                  </div>
                  <div>
                    <div class="small">Pause (min)</div>
                    <input class="input" id="breakMin" type="number" min="1" max="30" />
                  </div>
                  <div>
                    <div class="small">Pause longue (min)</div>
                    <input class="input" id="longBreakMin" type="number" min="5" max="60" />
                  </div>
                  <div>
                    <div class="small">Blocs avant pause longue</div>
                    <input class="input" id="blocksBeforeLong" type="number" min="2" max="8" />
                  </div>
                </div>

                <div class="split"></div>

                <div class="row" style="justify-content:space-between;">
                  <span class="small">Son (bip)</span>
                  <input id="soundOn" type="checkbox" />
                </div>
                <div class="row" style="justify-content:space-between; margin-top:8px;">
                  <span class="small">Vibration</span>
                  <input id="vibrateOn" type="checkbox" />
                </div>
                <div class="row" style="justify-content:space-between; margin-top:8px;">
                  <span class="small">Auto-start pause</span>
                  <input id="autoStartBreak" type="checkbox" />
                </div>
                <div class="row" style="justify-content:space-between; margin-top:8px;">
                  <span class="small">Auto-start focus</span>
                  <input id="autoStartFocus" type="checkbox" />
                </div>

                <div class="row" style="margin-top:10px;">
                  <button class="btn mini" id="saveTimerSettings">Enregistrer</button>
                </div>
              </div>
            </div>

            <div class="card" style="background:rgba(0,0,0,.12); box-shadow:none;">
              <div class="card-h">
                <div>
                  <h2 style="font-size:14px;">Top 3 (aujourd‚Äôhui)</h2>
                  <div class="muted">Marque un item avec üî• (dans les listes). Max 3.</div>
                </div>
              </div>
              <div class="card-b">
                <div class="list" id="top3List"></div>
                <div class="hint" id="top3Empty">Choisis 1‚Äì3 items avec üî• pour guider ta journ√©e.</div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- RITUALS -->
    <section id="tab-rituals" class="hidden">
      <div class="grid cols2">
        <div class="card">
          <div class="card-h">
            <div>
              <h2>Rituel d√©but de journ√©e (5 min)</h2>
              <div class="muted">Regarder Inbox ‚Üí choisir Top 3 ‚Üí Active ‚â§ limite.</div>
            </div>
          </div>
          <div class="card-b">
            <div class="hint">
              <strong style="color:var(--text);">Checklist</strong>
              <ul style="margin:8px 0 0; padding-left:18px;">
                <li>Regarder Inbox (sans se juger)</li>
                <li>Choisir 1‚Äì3 priorit√©s (Top 3)</li>
                <li>Rendre Active courte (‚â§ limite)</li>
              </ul>
            </div>
            <div class="split"></div>
            <div class="row" style="justify-content:space-between;">
              <div>
                <div style="font-weight:700;">Fait</div>
                <div class="small">Marque-le pour fermer la boucle</div>
              </div>
              <input type="checkbox" id="ritualStartDone" />
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-h">
            <div>
              <h2>Rituel fin de journ√©e (5 min)</h2>
              <div class="muted">Vider Inbox ‚Üí noter le prochain pas ‚Üí couper.</div>
            </div>
          </div>
          <div class="card-b">
            <div class="hint">
              <strong style="color:var(--text);">Checklist</strong>
              <ul style="margin:8px 0 0; padding-left:18px;">
                <li>Vider Inbox (trier vite)</li>
                <li>Noter ‚ÄúDemain je commence par ‚Ä¶‚Äù</li>
                <li>Stop : ‚Äúc‚Äôest assez bien‚Äù</li>
              </ul>
            </div>
            <div class="split"></div>
            <div class="row" style="justify-content:space-between;">
              <div>
                <div style="font-weight:700;">Fait</div>
                <div class="small">√áa aide le d√©marrage demain</div>
              </div>
              <input type="checkbox" id="ritualEndDone" />
            </div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <div class="card-h">
          <div>
            <h2>R√©glages de structure</h2>
            <div class="muted">Trop long = ton cerveau d√©croche. Garde Active courte.</div>
          </div>
        </div>
        <div class="card-b">
          <div class="row" style="justify-content:space-between;">
            <div>
              <div style="font-weight:700;">Limite Active</div>
              <div class="small">Entre 3 et 7</div>
            </div>
            <input class="input inline w-120" id="activeLimitInput" type="number" min="3" max="7"/>
          </div>
          <div class="row" style="margin-top:10px;">
            <button class="btn mini" id="saveStructure">Enregistrer</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PLAN -->
    <section id="tab-plan" class="hidden">
      <div class="card">
        <div class="card-h">
          <div>
            <h2>Plan de d√©ploiement (7 jours)</h2>
            <div class="muted">R√©gularit√© &gt; perfection (journ√©e off = normal).</div>
          </div>
        </div>
        <div class="card-b">
          <div class="list" id="planList"></div>
          <div class="hint" style="margin-top:12px;">
            <strong style="color:var(--text);">R√®gle anti-culpabilit√©</strong>
            <div style="margin-top:6px;">Syst√®me cass√© = on r√©pare. On ne se juge pas.</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-h">
          <div>
            <h2>Mini guide d‚Äôusage</h2>
            <div class="muted">Le flux compte plus que l‚Äôoutil.</div>
          </div>
        </div>
        <div class="card-b">
          <ol style="margin:0; padding-left:18px; color:var(--muted); font-size:13px;">
            <li>Capture tout dans Inbox (m√™me moche).</li>
            <li>1 fois/jour : transf√®re 0‚Äì5 items en Active.</li>
            <li>Le reste : Parking.</li>
            <li>D√©marre un focus sur un item (ou son ‚Äúprochain pas‚Äù).</li>
          </ol>
        </div>
      </div>
    </section>

    <div class="footer">Donn√©es stock√©es localement (localStorage). Export/Import disponible.</div>
  </div>

<script>
  // ====== STATE ======
  const LS_KEY = "tda_structured_work_simple_v1";

  const DEFAULT_STATE = {
    inbox: [],
    active: [],
    parking: [],
    ritualByDay: {},
    settings: {
      activeLimit: 5,
      sound: true,
      vibrate: true,
      autoStartBreak: false,
      autoStartFocus: false
    },
    timerPreset: {
      focusMin: 25,
      breakMin: 5,
      longBreakMin: 15,
      blocksBeforeLongBreak: 4
    }
  };

  function uid(){
    return Math.random().toString(16).slice(2) + Date.now().toString(16);
  }
  function todayKey(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }
  function loadState(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return structuredClone(DEFAULT_STATE);
      const parsed = JSON.parse(raw);
      return {
        ...structuredClone(DEFAULT_STATE),
        ...parsed,
        settings: { ...DEFAULT_STATE.settings, ...(parsed.settings||{}) },
        timerPreset: { ...DEFAULT_STATE.timerPreset, ...(parsed.timerPreset||{}) },
        ritualByDay: parsed.ritualByDay || {},
        inbox: Array.isArray(parsed.inbox)? parsed.inbox : [],
        active: Array.isArray(parsed.active)? parsed.active : [],
        parking: Array.isArray(parsed.parking)? parsed.parking : []
      };
    }catch(e){
      return structuredClone(DEFAULT_STATE);
    }
  }
  function saveState(){
    localStorage.setItem(LS_KEY, JSON.stringify(state));
  }

  let state = loadState();
  const day = todayKey();
  document.getElementById("today").textContent = day;

  function getRitual(){
    return state.ritualByDay[day] || { startDone:false, endDone:false, chosenTop3: [] };
  }
  function setRitual(patch){
    const r = getRitual();
    state.ritualByDay[day] = { ...r, ...patch };
    saveState();
    renderAll();
  }

  function tagLabel(tag){
    if(tag === "pro") return "Pro";
    if(tag === "perso") return "Perso";
    return "Mix";
  }

  // ====== TABS ======
  const tabs = document.querySelectorAll(".tab");
  const sections = {
    lists: document.getElementById("tab-lists"),
    focus: document.getElementById("tab-focus"),
    rituals: document.getElementById("tab-rituals"),
    plan: document.getElementById("tab-plan"),
  };

  tabs.forEach(t => t.addEventListener("click", () => {
    tabs.forEach(x => x.classList.remove("active"));
    t.classList.add("active");
    const name = t.dataset.tab;
    Object.keys(sections).forEach(k => sections[k].classList.toggle("hidden", k !== name));
  }));

  // ====== CRUD ======
  function addItem(listName, text, tag){
    const t = (text||"").trim();
    if(!t) return;
    const item = { id: uid(), text: t, tag: tag||"pro", createdAt: Date.now(), done:false, notes:"" };
    state[listName] = [item, ...state[listName]];
    saveState();
    renderAll();
  }
  function removeItem(listName, id){
    state[listName] = state[listName].filter(x => x.id !== id);
    const r = getRitual();
    if(r.chosenTop3.includes(id)){
      setRitual({ chosenTop3: r.chosenTop3.filter(x => x !== id) });
      return;
    }
    saveState();
    renderAll();
  }
  function toggleDone(listName, id){
    state[listName] = state[listName].map(x => x.id === id ? { ...x, done: !x.done } : x);
    saveState();
    renderAll();
  }
  function moveItem(from, to, id){
    const src = state[from];
    const item = src.find(x => x.id === id);
    if(!item) return;

    if(to === "active" && state.active.length >= state.settings.activeLimit){
      // active full
      return;
    }
    state[from] = src.filter(x => x.id !== id);
    state[to] = [item, ...state[to]];
    saveState();
    renderAll();
  }
  function setNotes(listName, id, notes){
    state[listName] = state[listName].map(x => x.id === id ? { ...x, notes: notes } : x);
    saveState();
    renderAll();
  }

  function toggleTop3(id){
    const r = getRitual();
    const has = r.chosenTop3.includes(id);
    if(has){
      setRitual({ chosenTop3: r.chosenTop3.filter(x => x !== id) });
      return;
    }
    if(r.chosenTop3.length >= 3) return;
    setRitual({ chosenTop3: [...r.chosenTop3, id] });
  }

  function findItemEverywhere(id){
    return [...state.active, ...state.inbox, ...state.parking].find(x => x.id === id);
  }

  // ====== RENDER ITEMS ======
  function renderList(listName, containerId, emptyId){
    const el = document.getElementById(containerId);
    const empty = document.getElementById(emptyId);
    el.innerHTML = "";
    const items = state[listName];
    empty.classList.toggle("hidden", items.length !== 0);

    items.forEach(item => {
      const div = document.createElement("div");
      div.className = "item";

      const r = getRitual();
      const isTop3 = r.chosenTop3.includes(item.id);

      div.innerHTML = `
        <div class="item-top">
          <div class="item-left">
            <div class="chk ${item.done ? "done" : ""}" title="Fait / Pas fait">${item.done ? "‚úì" : ""}</div>
            <div class="item-text">
              <div class="t ${item.done ? "done" : ""}" title="${escapeHtml(item.text)}">${escapeHtml(item.text)}</div>
              <div class="meta">
                <span class="chip">${tagLabel(item.tag)}</span>
                ${isTop3 ? `<span class="chip badge">Top 3</span>` : ``}
              </div>
            </div>
          </div>
          <div class="item-actions">
            <button class="btn mini" data-act="top3" title="Mettre dans Top 3 (max 3)">üî•</button>
            <button class="btn mini" data-act="notes" title="Notes / prochain pas">üìù</button>
            <button class="btn mini danger" data-act="del" title="Supprimer">üóëÔ∏è</button>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          ${listName !== "active" ? `<button class="btn mini" data-act="toActive" ${state.active.length >= state.settings.activeLimit ? "disabled" : ""}>‚Üí Active</button>` :
            `<button class="btn mini" data-act="toInbox">‚Üí Inbox</button>`}
          ${listName !== "parking" ? `<button class="btn mini" data-act="toParking">‚Üí Parking</button>` :
            `<button class="btn mini" data-act="toInbox">‚Üí Inbox</button>`}
        </div>

        ${item.notes ? `<div class="notes"><div class="small" style="margin-bottom:6px;">Notes</div>${escapeHtml(item.notes)}</div>` : ``}
      `;

      // Events
      div.querySelector(".chk").addEventListener("click", () => toggleDone(listName, item.id));

      div.querySelector('[data-act="del"]').addEventListener("click", () => {
        if(confirm("Supprimer cet item ?")) removeItem(listName, item.id);
      });

      div.querySelector('[data-act="top3"]').addEventListener("click", () => toggleTop3(item.id));

      const notesBtn = div.querySelector('[data-act="notes"]');
      notesBtn.addEventListener("click", () => {
        const current = item.notes || "";
        const val = prompt("Notes / prochain pas (‚â§ 2 min id√©alement) :", current);
        if(val === null) return;
        setNotes(listName, item.id, val.trim());
      });

      const toActive = div.querySelector('[data-act="toActive"]');
      if(toActive) toActive.addEventListener("click", () => moveItem(listName, "active", item.id));

      const toParking = div.querySelector('[data-act="toParking"]');
      if(toParking) toParking.addEventListener("click", () => moveItem(listName, "parking", item.id));

      const toInbox = div.querySelectorAll('[data-act="toInbox"]');
      toInbox.forEach(btn => btn.addEventListener("click", () => moveItem(listName, "inbox", item.id)));

      el.appendChild(div);
    });
  }

  function escapeHtml(str){
    return (str||"").replace(/[&<>"']/g, m => ({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m]));
  }

  // ====== COUNTS + BANNERS ======
  function renderCounts(){
    document.getElementById("countInbox").textContent = state.inbox.length;
    document.getElementById("countActive").textContent = state.active.length;
    document.getElementById("countParking").textContent = state.parking.length;

    document.getElementById("activeLimitPill").textContent = state.settings.activeLimit;
    document.getElementById("activeCountPill").textContent = state.active.length;
    document.getElementById("activeLimitText").textContent = state.settings.activeLimit;

    const full = state.active.length >= state.settings.activeLimit;
    document.getElementById("activeFullBanner").classList.toggle("hidden", !full);
  }

  // ====== TOP3 ======
  function renderTop3(){
    const r = getRitual();
    const list = document.getElementById("top3List");
    const empty = document.getElementById("top3Empty");
    list.innerHTML = "";

    const items = r.chosenTop3.map(id => findItemEverywhere(id)).filter(Boolean);
    empty.classList.toggle("hidden", items.length !== 0);

    items.forEach(it => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div class="item-top">
          <div class="item-left">
            <div class="logo" style="width:34px;height:34px;border-radius:14px;">üî•</div>
            <div class="item-text">
              <div class="t" title="${escapeHtml(it.text)}">${escapeHtml(it.text)}</div>
              <div class="meta"><span class="chip">${tagLabel(it.tag)}</span></div>
            </div>
          </div>
          <div class="item-actions">
            <button class="btn mini danger" title="Retirer">Retirer</button>
          </div>
        </div>
      `;
      div.querySelector("button").addEventListener("click", () => toggleTop3(it.id));
      list.appendChild(div);
    });
  }

  // ====== RITUALS UI ======
  function renderRituals(){
    const r = getRitual();
    const start = document.getElementById("ritualStartDone");
    const end = document.getElementById("ritualEndDone");
    start.checked = !!r.startDone;
    end.checked = !!r.endDone;
  }

  document.getElementById("ritualStartDone").addEventListener("change", (e) => {
    setRitual({ startDone: e.target.checked, startAt: e.target.checked ? Date.now() : undefined });
  });
  document.getElementById("ritualEndDone").addEventListener("change", (e) => {
    setRitual({ endDone: e.target.checked, endAt: e.target.checked ? Date.now() : undefined });
  });

  // ====== STRUCTURE SETTINGS ======
  function renderStructureSettings(){
    document.getElementById("activeLimitInput").value = state.settings.activeLimit;
  }
  document.getElementById("saveStructure").addEventListener("click", () => {
    const v = Number(document.getElementById("activeLimitInput").value || 5);
    state.settings.activeLimit = Math.min(7, Math.max(3, v));
    // If active > limit, keep but banner warns; user can move items out.
    saveState();
    renderAll();
    alert("R√©glages enregistr√©s.");
  });

  // ====== QUICK ADD + ADD FOR EACH LIST ======
  function wireAdd(inputId, tagId, btnId, listName){
    const input = document.getElementById(inputId);
    const tag = document.getElementById(tagId);
    const btn = document.getElementById(btnId);

    function go(){
      addItem(listName, input.value, tag.value);
      input.value = "";
    }
    btn.addEventListener("click", go);
    input.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        go();
      }
    });
  }

  wireAdd("addInboxText", "addInboxTag", "addInboxBtn", "inbox");
  wireAdd("addParkingText", "addParkingTag", "addParkingBtn", "parking");
  // Active respects limit
  (function(){
    const input = document.getElementById("addActiveText");
    const tag = document.getElementById("addActiveTag");
    const btn = document.getElementById("addActiveBtn");
    function go(){
      if(state.active.length >= state.settings.activeLimit) return;
      addItem("active", input.value, tag.value);
      input.value = "";
    }
    btn.addEventListener("click", go);
    input.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        go();
      }
    });
  })();

  // Quick capture always goes to inbox
  document.getElementById("quickAdd").addEventListener("click", () => {
    const t = document.getElementById("quickText");
    const tag = document.getElementById("quickTag");
    addItem("inbox", t.value, tag.value);
    t.value = "";
  });
  document.getElementById("quickText").addEventListener("keydown", (e) => {
    if(e.key === "Enter"){
      e.preventDefault();
      document.getElementById("quickAdd").click();
    }
  });

  // ====== EXPORT / IMPORT / RESET ======
  document.getElementById("exportBtn").addEventListener("click", () => {
    const payload = JSON.stringify(state, null, 2);
    const blob = new Blob([payload], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `tda-structure-${day}.json`;
    a.click();
    URL.revokeObjectURL(url);
  });

  document.getElementById("importInput").addEventListener("change", async (e) => {
    const file = e.target.files && e.target.files[0];
    if(!file) return;
    try{
      const text = await file.text();
      const parsed = JSON.parse(text);
      state = {
        ...structuredClone(DEFAULT_STATE),
        ...parsed,
        settings: { ...DEFAULT_STATE.settings, ...(parsed.settings||{}) },
        timerPreset: { ...DEFAULT_STATE.timerPreset, ...(parsed.timerPreset||{}) },
        ritualByDay: parsed.ritualByDay || {},
        inbox: Array.isArray(parsed.inbox)? parsed.inbox : [],
        active: Array.isArray(parsed.active)? parsed.active : [],
        parking: Array.isArray(parsed.parking)? parsed.parking : []
      };
      saveState();
      renderAll();
      alert("Import OK.");
    }catch(err){
      alert("Import impossible (JSON invalide).");
    }finally{
      e.target.value = "";
    }
  });

  document.getElementById("resetBtn").addEventListener("click", () => {
    if(!confirm("R√©initialiser Inbox/Active/Parking + rituels ? (Tu peux exporter avant)")) return;
    state = structuredClone(DEFAULT_STATE);
    saveState();
    renderAll();
  });

  // ====== TIMER ======
  let phase = "focus"; // focus | break | long_break
  let running = false;
  let remainingSec = state.timerPreset.focusMin * 60;
  let blocksDone = 0;
  let tick = null;

  function secondsToClock(total){
    total = Math.max(0, Math.floor(total));
    const mm = Math.floor(total/60);
    const ss = total % 60;
    return String(mm).padStart(2,"0") + ":" + String(ss).padStart(2,"0");
  }

  function phaseLabel(){
    if(phase === "focus") return "Focus";
    if(phase === "break") return "Pause";
    return "Pause longue";
  }

  function updateTimerUI(){
    document.getElementById("phaseLabel").textContent = phaseLabel();
    document.getElementById("blocksDone").textContent = blocksDone;
    document.getElementById("timeLeft").textContent = secondsToClock(remainingSec);
    document.getElementById("startPauseBtn").textContent = running ? "Pause" : "D√©marrer";
  }

  function beep(){
    let snd = new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");  
    snd.play();
  }
  function vibrate(ms=160){
    try{
      if("vibrate" in navigator) navigator.vibrate(ms);
    }catch(e){}
  }

  function stopTick(){
    if(tick){ clearInterval(tick); tick = null; }
  }
  function startTick(){
    stopTick();
    tick = setInterval(() => {
      remainingSec -= 1;
      if(remainingSec <= 0){
        remainingSec = 0;
        running = false;
        stopTick();
        if(state.settings.sound) beep();
        if(state.settings.vibrate) vibrate();

        if(phase === "focus"){
          blocksDone += 1;
          const isLong = (blocksDone % state.timerPreset.blocksBeforeLongBreak) === 0;
          phase = isLong ? "long_break" : "break";
          remainingSec = (isLong ? state.timerPreset.longBreakMin : state.timerPreset.breakMin) * 60;
          if(state.settings.autoStartBreak){ running = true; startTick(); }
        }else{
          phase = "focus";
          remainingSec = state.timerPreset.focusMin * 60;
          if(state.settings.autoStartFocus){ running = true; startTick(); }
        }
      }
      updateTimerUI();
    }, 1000);
  }

  document.getElementById("startPauseBtn").addEventListener("click", () => {
    running = !running;
    if(running) startTick(); else stopTick();
    updateTimerUI();
  });

  document.getElementById("resetTimerBtn").addEventListener("click", () => {
    running = false; stopTick();
    if(phase === "focus") remainingSec = state.timerPreset.focusMin * 60;
    if(phase === "break") remainingSec = state.timerPreset.breakMin * 60;
    if(phase === "long_break") remainingSec = state.timerPreset.longBreakMin * 60;
    updateTimerUI();
  });

  document.getElementById("setFocusBtn").addEventListener("click", () => {
    running = false; stopTick();
    phase = "focus";
    remainingSec = state.timerPreset.focusMin * 60;
    updateTimerUI();
  });
  document.getElementById("setBreakBtn").addEventListener("click", () => {
    running = false; stopTick();
    phase = "break";
    remainingSec = state.timerPreset.breakMin * 60;
    updateTimerUI();
  });
  document.getElementById("setLongBreakBtn").addEventListener("click", () => {
    running = false; stopTick();
    phase = "long_break";
    remainingSec = state.timerPreset.longBreakMin * 60;
    updateTimerUI();
  });

  function renderTimerSettings(){
    document.getElementById("focusMin").value = state.timerPreset.focusMin;
    document.getElementById("breakMin").value = state.timerPreset.breakMin;
    document.getElementById("longBreakMin").value = state.timerPreset.longBreakMin;
    document.getElementById("blocksBeforeLong").value = state.timerPreset.blocksBeforeLongBreak;

    document.getElementById("soundOn").checked = !!state.settings.sound;
    document.getElementById("vibrateOn").checked = !!state.settings.vibrate;
    document.getElementById("autoStartBreak").checked = !!state.settings.autoStartBreak;
    document.getElementById("autoStartFocus").checked = !!state.settings.autoStartFocus;
  }

  document.getElementById("saveTimerSettings").addEventListener("click", () => {
    state.timerPreset.focusMin = clampNum(document.getElementById("focusMin").value, 5, 90, 25);
    state.timerPreset.breakMin = clampNum(document.getElementById("breakMin").value, 1, 30, 5);
    state.timerPreset.longBreakMin = clampNum(document.getElementById("longBreakMin").value, 5, 60, 15);
    state.timerPreset.blocksBeforeLongBreak = clampNum(document.getElementById("blocksBeforeLong").value, 2, 8, 4);

    state.settings.sound = document.getElementById("soundOn").checked;
    state.settings.vibrate = document.getElementById("vibrateOn").checked;
    state.settings.autoStartBreak = document.getElementById("autoStartBreak").checked;
    state.settings.autoStartFocus = document.getElementById("autoStartFocus").checked;

    saveState();

    // if not running, refresh remaining to current phase
    if(!running){
      if(phase === "focus") remainingSec = state.timerPreset.focusMin * 60;
      if(phase === "break") remainingSec = state.timerPreset.breakMin * 60;
      if(phase === "long_break") remainingSec = state.timerPreset.longBreakMin * 60;
    }
    updateTimerUI();
    alert("R√©glages timer enregistr√©s.");
  });

  function clampNum(val, min, max, fallback){
    const n = Number(val);
    if(!Number.isFinite(n)) return fallback;
    return Math.max(min, Math.min(max, n));
  }

  // ====== PLAN 7J ======
  const PLAN = [
    { day: "Jour 1‚Äì2", title:"Inbox unique", desc:"Choisis UNE inbox. Supprime les autres listes. Capture tout, sans r√©fl√©chir." },
    { day: "Jour 3", title:"Liste Active (max 5)", desc:"Cr√©e ta liste Active. Si >5 ‚Üí ton cerveau d√©croche : on coupe." },
    { day: "Jour 4", title:"Blocs courts", desc:"Teste 25 min (ou 15). Objectif : un point d‚Äôentr√©e clair." },
    { day: "Jour 5", title:"Rituels 5 min", desc:"D√©but/fin de journ√©e : vider inbox + d√©finir le prochain pas." },
    { day: "Jour 6", title:"Ajuste sans culpabilit√©", desc:"Dur√©e des blocs, limites, alarms : adapte au r√©el." },
    { day: "Jour 7", title:"Bilan utile", desc:"Qu‚Äôest-ce qui aide vraiment ? Qu‚Äôest-ce qui est du bruit ?" },
  ];

  function renderPlan(){
    const el = document.getElementById("planList");
    el.innerHTML = "";
    PLAN.forEach(p => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div class="item-top">
          <div class="item-left">
            <div class="logo" style="width:34px;height:34px;border-radius:14px;">üìå</div>
            <div class="item-text">
              <div class="t"><strong>${escapeHtml(p.day)}</strong> ‚Ä¢ ${escapeHtml(p.title)}</div>
              <div class="meta"><span class="chip">${escapeHtml(p.desc)}</span></div>
            </div>
          </div>
        </div>
      `;
      el.appendChild(div);
    });
  }

  // ====== RENDER ALL ======
  function renderAll(){
    renderCounts();
    renderList("inbox", "listInbox", "emptyInbox");
    renderList("active", "listActive", "emptyActive");
    renderList("parking", "listParking", "emptyParking");
    renderTop3();
    renderRituals();
    renderStructureSettings();
    renderTimerSettings();
    renderPlan();
    updateTimerUI();
  }

  // Initial
  renderAll();
</script>
</body>
</html>